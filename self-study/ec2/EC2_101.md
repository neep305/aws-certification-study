# EC2 101
> AWS 자격증 대비를 위한 EC2 (Elastic Compute Cloud) 종합 학습 가이드

## 목차
1. [EC2 기본 개념](#1-ec2-기본-개념)
2. [인스턴스 유형 및 선택](#2-인스턴스-유형-및-선택)
3. [인스턴스 구매 옵션](#3-인스턴스-구매-옵션)
4. [보안 그룹 & 네트워크](#4-보안-그룹--네트워크)
5. [스토리지 옵션](#5-스토리지-옵션)
6. [IAM 역할과 EC2](#6-iam-역할과-ec2)
7. [Elastic IP (EIP)](#7-elastic-ip-eip)
8. [사용자 데이터 및 부트스트래핑](#8-사용자-데이터-및-부트스트래핑)
9. [메타데이터와 EC2 인스턴스 정보](#9-메타데이터와-ec2-인스턴스-정보)
10. [모니터링 및 CloudWatch](#10-모니터링-및-cloudwatch)
11. [자동 확장 (Auto Scaling)](#11-자동-확장-auto-scaling)
12. [로드 밸런싱](#12-로드-밸런싱)
13. [실습 및 핸즈온](#13-실습-및-핸즈온)

---

## 1. EC2 기본 개념

### 1.1 EC2란?
- **정의**: Elastic Compute Cloud - AWS의 핵심 가상 머신 서비스
- **특징**: 
  - 확장 가능한 컴퓨팅 용량
  - 종량제 결제 모델
  - 즉시 필요한 리소스 획득 및 해제 가능
  - 글로벌 서비스 (여러 리전과 AZ 지원)

### 1.2 EC2 인스턴스의 라이프사이클
- **Pending** → **Running** → **Stopping** → **Stopped** → **Terminated**
- **Rebooting**: 인스턴스 재시작 (퍼블릭 IP 유지)
- **Stopping & Starting**: 스토리지 유지, 퍼블릭 IP 변경 가능

### 1.3 인스턴스 상태 확인
- System Status Check (AWS 인프라)
- Instance Status Check (인스턴스 OS)

---

## 2. 인스턴스 유형 및 선택

### 2.1 인스턴스 패밀리별 용도
| 유형 | 특징 | 사용 사례 |
|------|------|---------|
| **General Purpose (t, m)** | 균형잡힌 성능 | 웹 서버, 중소 데이터베이스 |
| **Compute Optimized (c)** | 고성능 CPU | 배치 처리, 고성능 웹앱, 게이밍 |
| **Memory Optimized (r, x)** | 대용량 메모리 | 메모리 DB, 캐시, 빅데이터 |
| **Accelerated (p, g, f)** | GPU/FPGA | ML, 게이밍, 과학 계산 |
| **Storage Optimized (i, d, h)** | 고속 스토리지 | NoSQL DB, 데이터 웨어하우스 |

### 2.2 인스턴스 크기 (Size)
- nano < micro < small < medium < large < xlarge < 2xlarge < ...
- 크기가 커질수록 CPU, 메모리, 네트워크 성능 증가
- **Burstable 성능 (t 타입)**: CPU 크레딧 기반 성능

### 2.3 세대별 성능 비교
- 최신 세대일수록 더 높은 성능
- 비용 대비 성능 향상 고려

---

## 3. 인스턴스 구매 옵션

### 3.1 On-Demand 인스턴스
- 시간당 가격 지불 (초 단위 청구)
- 유연성 최고, 비용 최고
- 단기 워크로드, 예측 불가능한 작업에 적합

### 3.2 Reserved Instances (RI)
- 1년 또는 3년 약정 할인 (최대 72% 할인)
- **구매 옵션**: All Upfront, Partial Upfront, No Upfront
- **결제 옵션**: Standard (인스턴스 유형 고정), Convertible (변경 가능)
- 장기 안정적인 워크로드에 최적

### 3.3 Savings Plans
- 1년 또는 3년 약정 (최대 72% 할인)
- Compute Savings Plans: 인스턴스 패밀리/크기 변경 가능
- EC2 Instance Savings Plans: 특정 인스턴스 유형

### 3.4 Spot Instances
- 온디맨드 가격의 최대 90% 할인
- 언제든지 중단 가능 (2분 알림)
- 배치 작업, 테스트 환경에 적합
- **Spot Request**: 일회성, 지속적 요청 설정 가능

#### 3.4.1 Spot Instance 특징
- **가격 모델**: 스팟 가격 (온디맨드의 10-90% 수준, 시장에 따라 변동)
- **중단 조건**: 
  - AWS가 용량 필요 (확률 낮음)
  - 사용자 설정한 최대 가격 도달
  - 스팟 가격 상승 (사용자 최대 가격 초과)
- **2분 알림**: 중단 전 2분 경고 (graceful shutdown)
- **EBS 볼륨**: 기본적으로 종료 시 삭제 (보존 설정 가능)

#### 3.4.2 Spot Instance 사용 사례
```
높은 비용 절감 + 중단 가능:
- 배치 처리 (데이터 분석, 렌더링)
- 개발/테스트 환경
- 사이드 프로젝트
- 임시 웹 스크래핑
- 머신러닝 학습
- CI/CD 파이프라인

중단 불가능한 경우 (사용 금지):
- 프로덕션 데이터베이스
- 실시간 사용자 요청 처리
- 금융 거래 시스템
```

#### 3.4.3 Spot Request 타입
```
1. 일회성 (One-time) 요청
   - 인스턴스 중단 시 요청 종료
   - 임시 작업용

2. 지속적 (Persistent) 요청
   - 인스턴스 중단 후 자동 재요청
   - 지속적 실행 필요 시
   - 사용자가 요청을 명시적으로 취소할 때까지 계속
```

#### 3.4.4 Spot Instance 가격 전략
```
방법 1: 온디맨드 가격의 % 설정
- 최대 가격: t3.medium 온디맨드 가격의 70%
- AWS가 그 이하일 때 실행

방법 2: 고정 가격 설정
- 최대 가격: $0.05/시간
- 스팟 가격이 $0.05 이상 올라가면 중단

방법 3: Savings Plans + Spot
- Reserved Capacity 확보 + Spot 추가
- 최상의 비용 효율
```

#### 3.4.5 Spot Instance 모니터링
```bash
# AWS CLI로 스팟 가격 확인
aws ec2 describe-spot-price-history \
  --instance-types t3.medium t3.small \
  --product-descriptions "Linux/UNIX" \
  --region us-east-1

# 결과: 시간별 가격 변동 추이
```

#### 3.4.6 Spot Instance 시나리오
```
시나리오: 야간 배치 데이터 분석

구성:
1. Spot Instance 요청 설정
   - 인스턴스 유형: c5.2xlarge (계산 최적화)
   - 최대 가격: $0.30/시간 (온디맨드 $1.02)
   - 최대 인스턴스 수: 10개
   - 스팟 풀: c5, c5a, c5n, m5 등 다양하게

2. 중단 대비
   - EBS 볼륨 스냅샷 설정
   - 진행상황 정기 저장
   - 작업 재개 스크립트 준비

3. 모니터링
   - CloudWatch: 중단 이벤트 추적
   - SNS: 중단 전 알림

결과:
- 온디맨드: 10 × $1.02 × 8시간 = $81.60
- Spot: 10 × $0.30 × 8시간 = $24.00
- 절감: 약 70% 비용 절감
```

#### 3.4.7 Spot Instance 위험 관리
```
높은 가격 변동성 → 최대 가격을 넉넉하게 설정
갑작스러운 중단 → 중단 알림 활용, 체크포인트 저장
인스턴스 부족 → 여러 인스턴스 유형 요청 (Spot Fleet)
```

---

### 3.5 Spot Fleet

#### 3.5.1 Spot Fleet이란?
- **여러 Spot Instance를 관리하는 서비스**
- 다양한 인스턴스 유형/크기를 자동으로 조합
- 목표 용량을 유지하도록 자동 스케일링
- **높은 가용성**: 특정 인스턴스 중단 시 자동 대체

#### 3.5.2 Spot Fleet의 주요 특징
```
1. 다중 인스턴스 유형 지원
   └─ c5.large, c5.xlarge, m5.large, m5.xlarge 등 동시 사용

2. 목표 용량 유지
   └─ 총 vCPU 또는 인스턴스 개수 기반으로 자동 조정

3. 자동 대체
   └─ 가격 상승 시 저렴한 유형으로 자동 변경
   └─ 인스턴스 중단 시 자동 재시작

4. 할당 전략
   └─ lowestPrice: 가장 저렴한 옵션 선택
   └─ diversified: 여러 옵션에 분산
   └─ capacityOptimized: 용량 최적화
```

#### 3.5.3 Spot Fleet 설정 예시
```yaml
SpotFleetRequestConfig:
  IamFleetRole: arn:aws:iam::123456789012:role/fleet-role
  TargetCapacity: 10  # 목표 vCPU 또는 인스턴스 수
  
  LaunchSpecifications:
    - InstanceType: c5.large
      ImageId: ami-12345678
      KeyName: my-key
      MaxPrice: $0.10
      WeightedCapacity: 2  # vCPU 기준
    
    - InstanceType: c5.xlarge
      ImageId: ami-12345678
      KeyName: my-key
      MaxPrice: $0.20
      WeightedCapacity: 4
    
    - InstanceType: m5.large
      ImageId: ami-12345678
      KeyName: my-key
      MaxPrice: $0.12
      WeightedCapacity: 2

  AllocationStrategy: lowestPrice
  ValidFrom: 2025-01-01T00:00:00Z
  ValidUntil: 2025-12-31T23:59:59Z
```

#### 3.5.4 Spot Fleet 할당 전략

**1. lowestPrice (가장 저렴)**
```
목표: 10 vCPU
선택지:
- c5.large ($0.10): 2 vCPU
- c5.xlarge ($0.20): 4 vCPU
- m5.large ($0.12): 2 vCPU

선택 결과:
→ c5.large 5개 (10 vCPU × $0.10 = $1.00)
→ 가장 저렴하지만 단일 유형에 집중 (중단 위험)
```

**2. diversified (다양성)**
```
같은 목표에 여러 유형 분산:
→ c5.large 2개 + c5.xlarge 1개 + m5.large 2개 등
→ 높은 가용성 (중단 리스크 분산)
→ 가격은 조금 높음
```

**3. capacityOptimized (용량 최적)**
```
AWS가 최적 인스턴스 조합 추천:
→ 높은 가용성
→ 예측 불가능한 중단 최소화
→ 장기 워크로드 권장
```

#### 3.5.5 Spot Fleet 실행 상태
```
submitted → active_running → cancelled_running → cancelled_terminating
        └→ failed
        └→ cancelled
```

- **active**: 플릿 실행 중
- **cancelled**: 수동 취소 또는 조건 종료
- **terminated**: 모든 인스턴스 종료

#### 3.5.6 Spot Fleet 실행 상태
```
submitted → active_running → cancelled_running → cancelled_terminating
        └→ failed
        └→ cancelled
```

- **active**: 플릿 실행 중
- **cancelled**: 수동 취소 또는 조건 종료
- **terminated**: 모든 인스턴스 종료

> ### 🔑 Spot Instance + On-Demand 혼합 전략 (필독)
> 
> **문제 상황:**
> - Spot만 사용: 중단 시 서비스 장애
> - On-Demand만 사용: 비용 낭비
> 
> **해결책: 계층 구분 (Tiered Architecture)**
> 
> ```
> 계층 1: On-Demand (기본 용량)
>   └─ 핵심 서비스 + 기본 트래픽
>   └─ 중단 불가능
>   └─ 비용: 높음
>   └─ 비율: 50-70% (비용 중심)
> 
> 계층 2: Spot Fleet (추가 용량)
>   └─ 트래픽 증가 시 탄성적 대응
>   └─ 중단 허용 (Auto Scaling이 처리)
>   └─ 비용: 낮음 (90% 할감)
>   └─ 비율: 30-50% (비용 절감)
> ```
> 
> **실제 사용 사례:**
> 
> **사례 1: 전자상거래 (E-commerce)**
> ```
> 일일 트래픽 패턴:
> - 기본 트래픽: 1,000명 (매년 비슷)
> - 피크 시간(점심, 저녁): 5,000명 (예측 가능)
> - 이벤트/세일: 10,000명 (예측 불가능)
> 
> 구성:
> - On-Demand (3대, t3.xlarge): 기본 1,000명 처리
>   └─ 비용: $150/월 × 3 = $450/월
> 
> - RI (2대, c5.large 1년): 피크 시간 2,000명 추가
>   └─ 비용: $60/월 × 2 = $120/월
> 
> - Spot Fleet (5-10대, 다양한 유형): 이벤트/세일 대응
>   └─ 평상시: 0대 (비용 0원)
>   └─ 이벤트: 최대 10대 (예상 $200/월)
> 
> 총 비용:
> - 선택지 1 (On-Demand 10대): $1,500/월
> - 선택지 2 (RI 8대): $500/월
> - 선택지 3 (On-Demand 3 + RI 2 + Spot Fleet): $570/월
> 
> 절감: 약 62% (선택지 1 대비)
> 장점: 낮은 기본 비용 + 높은 가용성
> ```
> 
> **사례 2: 데이터 분석 (Big Data)**
> ```
> 일일 작업:
> - 기본 분석: 4 vCPU (매일)
> - 상세 분석: 8 vCPU (주간 5회)
> - 대규모 처리: 32 vCPU (월간 1회)
> 
> 구성:
> - On-Demand (1대, c5.xlarge): 기본 분석 24/7
>   └─ 비용: $200/월
> 
> - RI (1대, c5.2xlarge 1년): 상세 분석 기본
>   └─ 비용: $100/월
> 
> - Spot Fleet (10대, 다양한 c5/m5): 대규모 처리
>   └─ 필요 시에만 시작 ($150/월)
> 
> 총 비용:
> - 모두 온디맨드: $500/월
> - 혼합: $450/월 (평상시) + 이벤트 시 +$150
> 
> 절감: 약 10% (기본) + 70% (이벤트 시)
> 유연성: 높음 (필요한만큼 증설)
> ```
> 
> **사례 3: 웹 애플리케이션 (Web App)**
> ```
> 사용자: 10,000 DAU (Daily Active Users)
> 
> 구성 옵션 1 - 보수적:
> ├─ On-Demand 4대 (기본 + 안정성): 70%
> └─ Spot 2대 (추가 용량): 30%
> 비용: $600/월
> 
> 구성 옵션 2 - 공격적:
> ├─ On-Demand 2대 (최소 기본): 40%
> ├─ RI 2대 (안정 추가): 30%
> └─ Spot Fleet 4대 (탄성): 30%
> 비용: $400/월
> 
> 구성 옵션 3 - 추천 (균형):
> ├─ On-Demand 3대 (기본): 50%
> ├─ Spot Fleet 3대 (탄성): 50%
> 비용: $450/월
> 장점: 낮은 비용 + 높은 가용성
> ```
> 
> **혼합 전략의 핵심:**
> 
> 1. **핵심 서비스**: On-Demand (100% 가용성)
> 2. **보조 서비스**: Spot (중단 허용)
> 3. **자동 조정**: ASG + Spot Fleet으로 자동화
> 4. **모니터링**: Spot 중단 감지 → On-Demand로 자동 대체
> 5. **비용 추적**: 실시간 비용 모니터링
> 
> **배포 아키텍처 예시:**
> ```
> 로드 밸런서
>   ├─ On-Demand 인스턴스 1 (항상 실행)
>   ├─ On-Demand 인스턴스 2 (항상 실행)
>   ├─ On-Demand 인스턴스 3 (항상 실행) [최소 기본부하]
>   │
>   ├─ Spot 인스턴스 1 (트래픽 ↑ 시 추가)
>   ├─ Spot 인스턴스 2 (트래픽 ↑↑ 시 추가)
>   └─ Spot 인스턴스 N (필요한 만큼 확장)
> 
> Auto Scaling 규칙:
> - CPU > 70% → On-Demand 우선 추가
> - CPU > 85% → Spot Fleet으로 추가 확장
> - Spot 중단 감지 → 자동으로 On-Demand 추가
> ```
> 
> **비용 절감 계산 도구:**
> ```
> 기본 On-Demand: N개 인스턴스 × $1/시간 = $730/월
> 
> 혼합 전략:
> ├─ On-Demand 60%: N×0.6 × $1 = $438/월
> ├─ Spot Fleet 40%: N×0.4 × $0.10 = $29/월
> └─ 합계: $467/월
> 
> 절감액: $730 - $467 = $263/월 (36% 절감)
> 연간 절감: $3,156 (4서버 기준)
> ```

#### 3.5.7 Spot Fleet vs Auto Scaling Group

| 특성 | Spot Fleet | ASG |
|------|---|---|
| **Spot Instance** | 기본 제공 | 설정 필요 |
| **다중 유형** | 자동 선택 | 하나 유형만 |
| **가격 최적화** | 자동 조정 | 고정 |
| **인스턴스 분산** | 여러 유형 분산 | 단일 유형 |
| **초기 설정** | 복잡 | 간단 |
| **유지보수** | 자동 | 자동 |
| **권장 사용처** | 다양한 Spot 활용 | 온디맨드/RI |

#### 3.5.7 Spot Fleet 사용 사례
```
사용 사례 1: 빅데이터 분석
- 목표: 100 vCPU 확보
- Spot Fleet로 다양한 c5, m5 인스턴스 조합
- 비용 최소화 + 높은 가용성
- 예상: 온디맨드 대비 70-80% 절감

사용 사례 2: 머신러닝 학습
- 목표: 8개 GPU 인스턴스
- Spot Fleet: p3.2xlarge, p3.8xlarge, g4dn.xlarge 등 혼합
- 학습 중단 시 자동 재시작
- 예상: $5,000/월 → $1,000/월

사용 사례 3: 개발/테스트 환경
- 목표: 동적 개발 환경 구성
- 다양한 인스턴스 조합 + Spot 할인
- 환경 구성 시간 < 1분
- 예상: 월 $2,000 절감
```

#### 3.5.8 Spot Fleet 모니터링 및 제어
```bash
# AWS CLI로 Spot Fleet 상태 확인
aws ec2 describe-spot-fleet-requests \
  --region us-east-1

# 결과: 활성 플릿 목록
{
  "SpotFleetRequestConfigs": [
    {
      "SpotFleetRequestId": "sfr-12345678",
      "SpotFleetRequestState": "active_running",
      "FulfilledCapacity": 10,
      "TargetCapacity": 10
    }
  ]
}

# Spot Fleet 취소
aws ec2 cancel-spot-fleet-requests \
  --spot-fleet-request-ids sfr-12345678 \
  --terminate-instances
```

#### 3.5.9 Spot Fleet 장점 정리
1. **비용 최적화**: 온디맨드 대비 70-90% 절감
2. **자동 대체**: 중단된 인스턴스 자동 교체
3. **다양성**: 여러 인스턴스 유형 자동 조합
4. **확장성**: 용량 목표 자동 달성
5. **간편성**: 복잡한 수동 관리 불필요

#### 3.5.10 Spot Fleet 주의사항
- 중단 가능성 이해 필수
- 상태 저장 + 체크포인트 구현 필요
- 모니터링 및 알람 설정 필수
- 비용 추적 (플릿 내 여러 유형)

> ### 🔑 Spot Instance vs Spot Fleet 비교
> 
> | 특성 | Spot Instance | Spot Fleet |
> |------|---|---|
> | **관리 대상** | 단일 인스턴스 | 여러 인스턴스 |
> | **인스턴스 유형** | 1개 고정 | 여러 유형 자동 선택 |
> | **목표 용량** | 수동 관리 | 자동 유지 |
> | **중단 대체** | 없음 | 자동 재시작 |
> | **비용 최적화** | 기본적 | 고급 자동화 |
> | **설정 복잡도** | 낮음 | 높음 |
> | **권장 용도** | 작은 작업 | 대규모 워크로드 |
> 
> **실전 팁:**
> - 단일 작업: Spot Instance 사용
> - 여러 워커 조합: Spot Fleet 사용
> - 장시간 실행: Fleet 할당 전략 신중히
> - 모니터링: CloudWatch + SNS 필수

---

### 3.6 Dedicated Hosts / Dedicated Instances

#### 3.6.1 Dedicated Hosts란?
- **정의**: 물리적 서버 전체를 사용자 전용으로 예약
- **특징**: 
  - 단일 사용자를 위한 물리 서버
  - 완전한 제어와 가시성
  - 라이선스 이동 가능 (BYOL: Bring Your Own License)
  - 높은 비용 (온디맨드 대비 2-3배)

#### 3.6.2 Dedicated Instances vs Dedicated Hosts

| 특성 | Dedicated Instances | Dedicated Hosts |
|------|---|---|
| **대상** | 인스턴스 | 물리 서버 |
| **가시성** | 낮음 (공유 물리 서버) | 높음 (전용 물리 서버) |
| **라이선스 제어** | 없음 | 가능 (BYOL) |
| **소켓 제어** | 불가 | 가능 |
| **코어 제어** | 불가 | 가능 |
| **비용** | 낮음 | 높음 |
| **라이선스 이동** | 불가 | 가능 |
| **사용 사례** | 규정 준수 (기본) | 라이선스 제약 (고급) |

#### 3.6.3 Dedicated Hosts 사용 사례

**사용 사례 1: 소프트웨어 라이선스 최적화**
```
상황:
- 고가 소프트웨어 라이선스 보유 (예: Oracle, SAP)
- 라이선스 조건: "물리 CPU당 라이선스"
- 스스로 라이선스 관리 가능

문제 (On-Demand/RI 사용 시):
- AWS가 호스트 선택
- 예상보다 많은 물리 CPU 사용 가능
- 라이선스 비용 증가

해결 (Dedicated Hosts):
- 물리 서버 전체 예약
- 정확히 몇 개의 물리 CPU 사용하는지 알 수 있음
- 기존 라이선스를 클라우드로 이동 (절감)

예시:
- Oracle 라이선스: CPU당 $5,000/년
- 온프레미스: 4 socket × 12 core = 48 cores → $240,000/년
- AWS Dedicated Host (4소켓): $3,000/월 → $36,000/년
- 라이선스 이동: $240,000/년 (동일)
- 절감: 호스트 비용만 지출 (라이선스 중복 구매 없음)
```

**사용 사례 2: 규정 준수 및 감시 요구사항**
```
상황:
- 산업 규정: 의료(HIPAA), 금융(PCI-DSS), 정부(FedRAMP)
- 요구사항: "전용 물리 인프라 필요"

해결:
- Dedicated Host로 규정 증명
- 감사 추적 용이
- 물리 서버 격리 보장

예시:
- 의료 데이터 처리 시스템
- 규정: "데이터는 전용 하드웨어에서만"
- Dedicated Host 제공: 감사 통과
```

**사용 사례 3: 성능 및 가시성 요구**
```
상황:
- 높은 성능 필요
- 물리 자원 가시성 중요
- 다른 사용자와의 간섭 최소화

해결:
- Dedicated Host로 완벽한 격리
- 물리 서버의 모든 자원 활용 가능
- CPU, 메모리, 네트워크 성능 예측 가능

예시:
- 금융 고빈도 거래(HFT) 시스템
- 요구: 지연시간 < 1ms
- Dedicated Host: 다른 테넌트 없음 → 안정적 성능
```

#### 3.6.4 Dedicated Hosts 할당 및 해제

**할당:**
```bash
# AWS CLI로 Dedicated Host 할당
aws ec2 allocate-hosts \
  --instance-type m5.large \
  --availability-zone us-east-1a \
  --quantity 1 \
  --tag-specifications 'ResourceType=dedicated-host,Tags=[{Key=Name,Value=MyHost}]'

# 응답
{
  "HostIds": ["h-0123456789abcdef0"]
}
```

**인스턴스 시작:**
```bash
# Dedicated Host에서 인스턴스 실행
aws ec2 run-instances \
  --image-id ami-12345678 \
  --instance-type m5.large \
  --placement '{
    "HostId": "h-0123456789abcdef0",
    "Tenancy": "host"
  }' \
  --key-name MyKeyPair
```

**해제:**
```bash
# 모든 인스턴스 종료 후 Host 해제
aws ec2 release-hosts \
  --host-ids h-0123456789abcdef0
```

#### 3.6.5 Dedicated Hosts 가용성 및 용량

```
물리 서버 선택 예시:

m5.large Dedicated Host:
├─ 물리 CPU: 96 vCPU (2 socket × 48 cores)
├─ 메모리: 384 GB
├─ 네트워크: 100Gbps
├─ 할당 가능 인스턴스:
│  ├─ m5.large × 50개
│  ├─ m5.xlarge × 25개
│  └─ m5.2xlarge × 12개
├─ 가격: $2,580/월 (On-Demand) 또는 $1,548/월 (1년 RI)
└─ 사용 방식:
   ├─ 모두 사용: 50 × $0.096/시간 = $4.80/시간
   ├─ 절반 사용: 25 × $0.096/시간 = $2.40/시간
   └─ → Host 비용은 동일 (할당 비용)
```

#### 3.6.6 Dedicated Hosts 비용 모델

```
Host 할당:
├─ On-Demand: $2,580/월 (m5.large 기준)
├─ 1년 RI: 35% 할인 → $1,677/월
└─ 3년 RI: 55% 할인 → $1,161/월

인스턴스 비용: 없음 (Host 할당에 포함)

예시 (m5.large 10개):
- On-Demand 인스턴스 × 10: $0.096 × 10 × 730시간 = $700/월
- Dedicated Host (RI 1년): $1,677/월
- 비율: Host 비용이 높음 (라이선스 절감으로 상쇄 가능)
```

#### 3.6.7 Dedicated Hosts vs Reserved Instances

| 관점 | Dedicated Host | RI |
|------|---|---|
| **라이선스 절감** | 최고 (BYOL 가능) | 낮음 |
| **가격** | 높음 | 보통 |
| **규정 준수** | 높음 | 낮음 |
| **유연성** | 낮음 (고정) | 보통 |
| **사용 사례** | 라이선스 중심 | 비용 절감 중심 |

> ### 🔑 Dedicated Hosts 선택 가이드
> 
> **Dedicated Hosts가 필요한 경우:**
> ```
> 1. BYOL 라이선스 보유
>    └─ Oracle, SAP, Windows Server, SQL Server 등
>    └─ 라이선스를 AWS로 이동하고 싶음
> 
> 2. 규정 준수 요구
>    └─ "전용 하드웨어" 필수 (의료, 금융, 정부)
>    └─ 감시/감사 기록 필요
> 
> 3. 라이선싱 제약
>    └─ 소켓/코어 단위 라이선스
>    └─ 라이선스 이동 제어 필요
> 
> 4. 성능 일관성
>    └─ 다른 사용자 간섭 제거
>    └─ 물리 자원 완벽 제어
> ```
> 
> **Dedicated Hosts를 피해야 하는 경우:**
> ```
> 1. 라이선스 제약 없음
>    └─ 일반 애플리케이션
>    └─ 오픈소스만 사용
> 
> 2. 비용 최소화 중심
>    └─ Dedicated Host 비용 높음
>    └─ RI/Spot이 더 저렴
> 
> 3. 유연성 필요
>    └─ 인스턴스 타입 변경 (Dedicated Host는 고정)
>    └─ 동적 스케일링
> 
> 4. 정규 워크로드
>    └─ 장시간 Host 미사용 가능
>    └─ 비용 낭비
> ```

---

### 3.7 구매 옵션 선택 가이드

```
안정적인 장기 워크로드
(예: 웹 서버, DB)
    ↓
Reserved Instances / Savings Plans
(1년-3년 약정, 최대 72% 할인)
┌──────────────────────────────────┐
│ 예: t3.medium RI 1년 $150         │
│ vs 온디맨드 월 $30 × 12 = $360   │
│ 절감: $210 (58%)                 │
└──────────────────────────────────┘

예측 불가능한 단기 작업
(예: 테스트, 개발)
    ↓
On-Demand 인스턴스
(유연성 최고, 비용 높음)
┌──────────────────────────────────┐
│ 예: t3.medium 온디맨드            │
│ 월 $30 × 사용 월 = 실제 비용    │
└──────────────────────────────────┘

중단 가능한 비용 민감 작업
(배치, 테스트, 개발 환경)
    ↓
Spot Instance / Spot Fleet
(온디맨드 대비 최대 90% 할인)
┌──────────────────────────────────┐
│ 예: 동일 인스턴스 Spot $3-6/월   │
│ vs 온디맨드 $30/월                 │
│ 절감: 약 80% 이상                 │
└──────────────────────────────────┘

규정/라이선스 준수 필요
(예: 소프트웨어 라이선스)
    ↓
Dedicated Hosts
(물리 서버 전체 예약)
┌──────────────────────────────────┐
│ 예: 라이선스 가져오기 (BYOL)     │
│ 규정 준수 (의료, 금융)           │
└──────────────────────────────────┘
```

**혼합 전략 (권장)**:
```
프로덕션 기본부하: Reserved Instances
트래픽 증가 대응: On-Demand
비용 최적화: Spot Fleet
개발/테스트: Spot Instance
```

---

### 3.8 구매 옵션별 비용 비교

| 워크로드 | 인스턴스 | 온디맨드 | RI (1년) | 비용 절감 | Spot | 절감율 |
|---------|---------|---------|---------|---------|------|--------|
| **일일 8시간 배치** | t3.medium | $7.20 | N/A | - | $0.72 | 90% |
| **주중 근무시간만** | m5.large | $96/월 | $60/월 | 37% | $10/월 | 90% |
| **24/7 운영** | c5.xlarge | $167/월 | $79/월 | 53% | $20/월 | 88% |
| **3년 약정** | r5.2xlarge | $434/월 | $141/월 | 67% | $50/월 | 88% |

---

### 3.9 자격증 시험: 구매 옵션 문제 유형

**유형 1: 비용 최적화**
```
Q: 월 $10,000 비용의 프로덕션 웹 서버를 운영합니다.
   최대 비용 절감 방법은?

A) On-Demand 유지
B) Reserved Instances 1년 약정
C) Reserved Instances 3년 약정 + Spot Fleet
D) Dedicated Hosts로 변경

정답: C
해설: 
- RI 3년: 약 72% 할감 ($2,800/월)
- Spot Fleet 추가: 10%분량에 90% 할감
- 조합: 약 60-70% 절감 가능
```

**유형 2: 상황별 선택**
```
Q: 야간 배치 작업이 중단되어도 괜찮습니다.
   가장 저렴한 옵션은?

A) On-Demand
B) Reserved Instances
C) Spot Instance
D) Savings Plans

정답: C
해설: 
- 중단 가능 → Spot 사용
- 최대 90% 할감 가능
- 배치 작업이므로 2분 알림으로 충분
```

**유형 3: 가용성과 비용**
```
Q: 프로덕션 서비스의 고가용성과 비용 절감을 동시에
   원합니다. 최적의 구성은?

A) On-Demand만 사용
B) RI 50% + On-Demand 50%
C) RI 70% + Spot Fleet 30%
D) Spot Instance 100%

정답: C
해설:
- RI: 안정적인 기본부하 커버
- Spot Fleet: 트래픽 증가 시 대응 (중단 위험 낮음)
- 조합: 비용 절감 + 가용성 확보
```

**유형 4: Dedicated Hosts (영문 객관식)**
```
Q: Your company has licenses for Oracle Database that are 
   bound to physical CPU cores. You need to migrate these 
   databases to AWS while maintaining the existing licenses. 
   What should you use to achieve this?

A) Use Reserved Instances with instance type that matches 
   your current physical cores
   
B) Allocate Dedicated Hosts and launch instances with 
   host affinity to use your existing BYOL licenses
   
C) Use Spot Instances with interruption protection enabled 
   to maintain continuity
   
D) Launch instances in a VPC with dedicated tenancy and 
   apply license agreements to the account

정답: B

해설:
- Dedicated Hosts는 물리 서버 전체를 사용자에게 제공
- BYOL (Bring Your Own License) 지원
- 소켓/코어 단위 라이선스 제어 가능
- A 오답: RI는 라이선스 이동 미지원
- C 오답: Spot은 중단 가능, 라이선스 제어 불가
- D 오답: VPC Tenancy는 BYOL 제어 미지원

추가 학습:
- Dedicated Instances와 다름:
  └─ Dedicated Instances: VPC 내 전용 물리 하드웨어
  └─ Dedicated Hosts: 전체 물리 서버 제어
- 라이선스 이동성:
  └─ Dedicated Hosts: 라이선스 이동 가능 ✓
  └─ Dedicated Instances: 라이선스 이동 불가 ✗
- 소켓/코어 가시성:
  └─ Dedicated Hosts: 완벽 가시성 (호스트 명시)
  └─ Dedicated Instances: 가시성 없음
```

---

## 4. 보안 그룹 & 네트워크

### 4.1 Security Group (보안 그룹)
- **방화벽 역할**: Inbound/Outbound 트래픽 제어
- **상태 저장 (Stateful)**: 응답 트래픽은 자동 허용
- **디폴트**: Inbound 모두 거부, Outbound 모두 허용
- **VPC별 격리**: VPC 내 인스턴스만 참조 가능

### 4.2 Inbound 규칙 설정
```yaml
Protocol: TCP/UDP/ICMP/All
Port Range: 0-65535
Source: 특정 IP, IP 범위, 보안 그룹, 모든 곳 (0.0.0.0/0)
```

**일반적인 포트**:
- 80 (HTTP), 443 (HTTPS)
- 22 (SSH - Linux), 3389 (RDP - Windows)
- 3306 (MySQL), 5432 (PostgreSQL)
- 6379 (Redis), 27017 (MongoDB)

### 4.3 Outbound 규칙
- 기본적으로 모든 트래픽 허용
- 필요시 특정 트래픽만 허용으로 제한 가능

### 4.4 Network ACLs (NACLs)
- **서브넷 레벨**: VPC 내 트래픽 제어
- **Stateless**: 명시적 규칙 필요
- **순번**: 낮은 번호부터 평가

> ### 🔑 Security Group vs NACL 비교
> 
> | 특성 | Security Group | NACL |
> |------|---|---|
> | **적용 대상** | 인스턴스 (ENI) | 서브넷 |
> | **방향** | Inbound/Outbound | Inbound/Outbound |
> | **상태 추적** | Stateful (상태 저장) | Stateless (상태 미저장) |
> | **응답 트래픽** | 자동 허용 | 명시적 규칙 필요 |
> | **평가 방식** | 모든 규칙 평가 | 순번 순서로 평가 (ALLOW/DENY) |
> | **DENY 규칙** | 불가능 (허용만 가능) | 가능 |
> | **기본값** | Inbound 거부, Outbound 허용 | 모두 허용 |
> 
> **실전 팁:**
> - Security Group: 특정 인스턴스 보호 (세밀한 제어)
> - NACL: 서브넷 전체 보호 (광범위한 제어)
> - 일반적으로 Security Group만 사용해도 충분 (NACL은 고급)

### 4.5 VPC & 서브넷
- **VPC**: 격리된 네트워크 환경
- **퍼블릭 서브넷**: 인터넷 게이트웨이를 통한 인터넷 접근
- **프라이빗 서브넷**: NAT 게이트웨이를 통한 아웃바운드만 가능
- **라우팅 테이블**: 트래픽 경로 정의

### 4.6 Elastic Network Interface (ENI)
- 인스턴스에 연결된 가상 네트워크 인터페이스
- MAC 주소, 프라이빗 IP, EIP, 보안 그룹 포함
- 실행 중인 인스턴스에 추가 ENI 연결 가능

---

## 5. 스토리지 옵션

### 5.1 EBS (Elastic Block Store)
- **특징**: 인스턴스에 연결된 블록 스토리지
- **성능 지속성**: 인스턴스 중지/시작 후에도 유지
- **스냅샷**: 백업 및 복제 용도

**EBS 볼륨 유형**:
| 유형 | 사용 사례 | IOPS | 처리량 |
|------|---------|------|--------|
| **gp3** | 일반 용도 (권장) | 최대 16,000 | 최대 1,000 MB/s |
| **gp2** | 일반 용도 (이전) | 최대 16,000 | 최대 250 MB/s |
| **io1/io2** | 고성능 DB | 64,000 IOPS | 1,000 MB/s |
| **st1** | 빅데이터, 로그 | 500 IOPS | 500 MB/s |
| **sc1** | 콜드 스토리지 | 250 IOPS | 250 MB/s |

### 5.2 EBS 암호화
- 기본 전송 중 암호화
- KMS 키를 사용한 저장 데이터 암호화
- 무중단 암호화 활성화/비활성화 가능

### 5.3 인스턴스 스토어 (Instance Store)
- **특징**: 임시 블록 레벨 스토리지
- **성능**: EBS보다 높은 I/O 성능
- **주의**: 인스턴스 종료 시 데이터 손실
- **용도**: 캐시, 임시 데이터, 스크래치

### 5.4 S3 (Simple Storage Service)
- **객체 스토리지**: 파일 저장
- **용도**: 정적 웹사이트, 백업, 로그
- EC2에서 IAM 역할을 통해 접근

### 5.5 EFS (Elastic File System)
- **공유 파일 시스템**: 여러 인스턴스에서 동시 접근
- **POSIX 호환**: Linux 표준 파일 시스템
- **자동 확장**: 사용량에 따라 자동 증가
- **용도**: 컨텐츠 관리, 공동 스토리지

### 5.6 스토리지 비교
```
용도         → 선택 권장
높은 성능    → 인스턴스 스토어
영구 저장    → EBS (gp3)
공유 스토리지 → EFS
객체 저장    → S3
```

---

## 6. IAM 역할과 EC2

### 6.1 IAM 역할 (EC2 Instance Role)
- 인스턴스에 AWS 권한 부여
- **AccessKey 저장 불필요**: 보안 강화
- **임시 보안 자격증명**: 자동 갱신

### 6.2 Instance Profile
- IAM 역할을 인스턴스에 연결하는 매개변수
- EC2 런칭 시 지정

### 6.3 사용 사례
- S3, DynamoDB, RDS 접근
- CloudWatch 로그 전송
- SSM Parameter Store/Secrets Manager 접근
- 다른 AWS 서비스 호출

### 6.4 권한 설정 예시
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::my-bucket/*"
    }
  ]
}
```

---

## 7. Elastic IP (EIP)

### 7.1 Elastic IP란?
- **고정 퍼블릭 IP**: 인스턴스 시작/중지 후에도 유지
- **리전별 할당**: 각 리전에서 최대 5개 (증설 가능)
- **비용**: 할당받은 상태에서 사용하지 않으면 요금 발생

> ### 🔑 Public IP vs Elastic IP 비교
> 
> | 특성 | Public IP | Elastic IP |
> |------|---|---|
> | **할당** | 자동 (서브넷 설정) | 수동 할당 |
> | **비용** | 무료 | 미사용 시 요금 발생 |
> | **지속성** | 인스턴스 중지/시작 시 변경 | 고정 유지 |
> | **인스턴스 종료** | 자동 해제 | 수동 해제 필요 |
> | **재할당** | 새 인스턴스에 자동 할당 | 명시적으로 이동 가능 |
> | **용도** | 임시 접근 | 고정 IP 필요 (DNS, 화이트리스트) |
> 
> **실전 팁:**
> - **Public IP**: 테스트, 임시 접근용
> - **Elastic IP**: 프로덕션 서버, DNS 연결, IP 고정 필요 시
> - 장기 미사용 EIP는 해제해서 비용 절감!

### 7.2 EIP 할당 및 연결
1. EIP 할당받기 (AWS 계정)
2. 실행 중인 인스턴스에 연결
3. 중지된 인스턴스에도 연결 가능

### 7.3 사용 사례
- 인스턴스 재시작 후 같은 IP 유지 필요
- DNS A 레코드 고정
- 화이트리스팅이 필요한 경우

### 7.4 주의사항
- 할당했으나 미사용 EIP는 비용 발생
- 인스턴스 종료 시 EIP 해제하여 비용 절감

---

## 8. 사용자 데이터 및 부트스트래핑

### 8.1 User Data (사용자 데이터)
- 인스턴스 최초 시작 시 실행되는 스크립트
- root 권한으로 실행
- 최대 16KB (압축 가능)
- **런칭 시에만 실행**: 재시작 시 실행 안 됨

### 8.2 구문
```bash
#!/bin/bash
# 모든 패키지 업데이트
yum update -y

# Apache 웹 서버 설치
yum install -y httpd
systemctl start httpd
systemctl enable httpd

# 홈페이지 작성
echo "<h1>Hello from $(hostname -f)</h1>" > /var/www/html/index.html
```

### 8.3 사용 사례
- OS 패키지 설치
- 애플리케이션 배포
- 모니터링 에이전트 설치
- 환경 변수 설정

### 8.4 모니터링
- CloudWatch에서 `/var/log/cloud-init-output.log` 확인
- EC2 시스템 로그 검토

---

## 9. 메타데이터와 EC2 인스턴스 정보

### 9.1 EC2 메타데이터 (Metadata)
- 인스턴스에 대한 정보 제공
- **엔드포인트**: `http://169.254.169.254/latest/meta-data/`
- 실행 중인 인스턴스에서만 접근 가능

### 9.2 주요 메타데이터
```bash
# 인스턴스 ID
curl http://169.254.169.254/latest/meta-data/instance-id

# 인스턴스 유형
curl http://169.254.169.254/latest/meta-data/instance-type

# 퍼블릭 IP 주소
curl http://169.254.169.254/latest/meta-data/public-ipv4

# 프라이빗 IP 주소
curl http://169.254.169.254/latest/meta-data/local-ipv4

# IAM 역할 정보
curl http://169.254.169.254/latest/meta-data/iam/security-credentials/
```

### 9.3 User Data 접근
- **엔드포인트**: `http://169.254.169.254/latest/user-data/`
- 사용자가 전달한 스크립트 조회

### 9.4 IMDSv2 (메타데이터 서비스 v2)
- 더 안전한 토큰 기반 접근
- **권장**: 모든 인스턴스에서 IMDSv2 사용
- 토큰 획득 후 메타데이터 요청

---

## 10. 모니터링 및 CloudWatch

### 10.1 CloudWatch 메트릭
기본 모니터링 (5분 단위):
- CPU Utilization
- Network In/Out
- Disk Read/Write Bytes
- Status Check Failed

상세 모니터링 (1분 단위):
- 동일 메트릭 + 추가 메트릭

### 10.2 CloudWatch 알람
- 메트릭 기반 알람 설정
- SNS, Lambda, Auto Scaling 트리거
- 상태: OK, ALARM, INSUFFICIENT_DATA

### 10.3 CloudWatch 로그
- 애플리케이션 로그 중앙화
- CloudWatch Logs Agent로 로그 수집
- 로그 그룹 및 스트림 생성

### 10.4 대시보드
- 여러 메트릭을 시각화
- 실시간 모니터링
- 커스텀 대시보드 생성

---

## 11. 자동 확장 (Auto Scaling)

### 11.1 Auto Scaling Group (ASG)
- 인스턴스 개수를 자동으로 조정
- **최소, 원하는, 최대 용량** 설정
- 건강성 확인 후 비정상 인스턴스 자동 교체

### 11.2 런치 템플릿 (Launch Template)
- 인스턴스 구성 정의
- 인스턴스 유형, AMI, 보안 그룹, 키 페어 포함
- 버전 관리 지원

### 11.3 스케일링 정책
- **동적 스케일링**: 메트릭 기반 (CPU, 네트워크)
- **예측 스케일링**: 머신러닝 기반
- **스케줄 스케일링**: 시간/요일 기반
- **스텝 스케일링**: 메트릭 정도에 따른 단계적 조정

### 11.4 건강성 확인 (Health Check)
- EC2 상태 확인
- ELB 상태 확인 (로드 밸런서 연결 시)
- 커스텀 헬스 체크

### 11.5 라이프사이클 훅 (Lifecycle Hooks)
- 스케일링 중 특정 작업 수행
- 인스턴스 종료 전 정리 작업

---

## 12. 로드 밸런싱

### 12.1 Elastic Load Balancer (ELB)
여러 인스턴스로 트래픽 분산

**ALB (Application Load Balancer)**:
- 계층 7 (애플리케이션 계층)
- 호스트명, 경로 기반 라우팅
- HTTP/HTTPS

**NLB (Network Load Balancer)**:
- 계층 4 (전송 계층)
- 극도의 성능 필요 (게이밍, IoT)
- TCP/UDP

**CLB (Classic Load Balancer)**:
- 이전 세대 (계층 4+7)
- 권장 안 함 (ALB/NLB 사용)

### 12.2 대상 그룹 (Target Group)
- 로드 밸런서가 트래픽을 보낼 대상 집합
- 건강성 확인
- Auto Scaling과 통합

### 12.3 리스너 (Listener)
- 특정 포트와 프로토콜 모니터링
- 규칙에 따라 트래픽 라우팅

### 12.4 스티키 세션 (Session Stickiness)
- 클라이언트를 같은 대상으로 고정
- 쿠키 기반 또는 기간 기반
- 실제 장애 증상
  - “로그인이 자꾸 풀려요”
  - “장바구니가 비어요”
  - 재현이 랜덤 → 디버깅 매우 어려움 😱

---

## 13. 실습 및 핸즈온

### 13.1 기본 워크플로우
1. **EC2 인스턴스 런칭**
   - AMI 선택
   - 인스턴스 유형 선택
   - VPC, 서브넷, IAM 역할 설정
   - 스토리지 구성
   - 태그 추가
   - 보안 그룹 설정
   - 키 페어 생성/선택

2. **인스턴스 접근**
   ```bash
   # Linux (SSH)
   ssh -i my-key.pem ec2-user@<public-ip>
   
   # Windows (RDP)
   # RDP 파일 다운로드 후 원격 데스크톱 연결
   ```

3. **애플리케이션 배포**
   - 패키지 설치
   - 코드 배포
   - 서비스 시작

4. **모니터링 설정**
   - CloudWatch 메트릭 확인
   - 알람 설정

### 13.2 실습 항목 체크리스트
- [ ] EC2 인스턴스 생성 및 종료
- [ ] 보안 그룹 규칙 설정
- [ ] EIP 할당 및 연결
- [ ] EBS 볼륨 생성 및 마운트
- [ ] 사용자 데이터로 웹 서버 배포
- [ ] 메타데이터 조회 테스트
- [ ] 다양한 인스턴스 유형 비교
- [ ] Auto Scaling Group 구성
- [ ] 로드 밸런서 설정
- [ ] IAM 역할 생성 및 적용

### 13.3 권장 학습 순서
1. EC2 기본 개념 이해
2. 인스턴스 생성 및 관리 연습
3. 네트워크 구성 (보안 그룹, VPC)
4. 스토리지 옵션 실습
5. 사용자 데이터를 통한 자동화
6. 모니터링 및 로깅 설정
7. 고급 기능 (Auto Scaling, ELB)
8. 실제 애플리케이션 배포

---

## 자격증 시험 팁
- **AWS 공식 문서**: [EC2 User Guide](https://docs.aws.amazon.com/ec2/)
- **문제 유형**: 시나리오 기반, 비용 최적화, 보안
- **자주 출제되는 항목**: 보안 그룹, IAM 역할, 구매 옵션, Auto Scaling
- **실습**: 프리 티어를 활용하여 직접 경험
- **모의 시험**: AWS 공식 모의 시험으로 준비