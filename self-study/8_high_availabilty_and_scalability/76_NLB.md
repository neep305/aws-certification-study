# Network Load Balancer (NLB) β€“ SAA μ‹ν— λ€λΉ„ μ”μ•½ μ •λ¦¬

## 1. Network Load Balancer κ°μ”
- **OSI Layer 4 (μ „μ†΅ κ³„μΈµ)** μ—μ„ λ™μ‘
- **μ΄κ³ μ„±λ¥, μ΄μ €μ§€μ—°** νΈλν”½ μ²λ¦¬λ¥Ό μ„ν• λ΅λ“ λ°Έλ°μ„
- TCP/UDP κΈ°λ° μ• ν”λ¦¬μΌ€μ΄μ…μ— μµμ ν™”
- μλ°±λ§ TPS(μ΄λ‹Ή μ”μ²­)λ¥Ό λ§¤μ° λ‚®μ€ μ§€μ—° μ‹κ°„μΌλ΅ μ²λ¦¬ κ°€λ¥

---

## 2. μ§€μ› ν”„λ΅ν† μ½
- **TCP**
- **UDP**
- **TLS** (NLBμ—μ„ TLS μΆ…λ£ κ°€λ¥)
- **TCP_UDP**

π“ **μ‹ν— ν¬μΈνΈ**
- HTTP/HTTPS κΈ°λ° λΌμ°ν…μ€ **ALB**
- μμ λ„¤νΈμ›ν¬ νΈλν”½, κ³ μ • IP ν•„μ” β†’ **NLB**

---

## 3. μ£Όμ” νΉμ§• (μ‹ν—μ— μμ£Ό λ‚μ¤λ” ν¬μΈνΈ)

### 3.1 κ³ μ • IP μ£Όμ† μ§€μ›
- κ° **Availability Zoneλ‹Ή 1κ°μ κ³ μ • IP**
- Elastic IP(EIP) ν• λ‹Ή κ°€λ¥
- λ°©ν™”λ²½, ν™”μ΄νΈλ¦¬μ¤νΈ IP μ”κµ¬ μ‚¬ν•­μ— μ ν•©

### 3.2 μ΄μ €μ§€μ—° & κ³ μ„±λ¥
- μ§€μ—° μ‹κ°„: **μ λ°€λ¦¬μ΄(ms)**
- νΈλν”½ λ³€λ™μ΄ ν° μ›ν¬λ΅λ“μ— μλ™ λ€μ‘

### 3.3 ν΄λΌμ΄μ–ΈνΈ IP λ³΄μ΅΄
- **Source IP λ³΄μ΅΄**
- λ°±μ—”λ“ μ„λ²„μ—μ„ μ‹¤μ  ν΄λΌμ΄μ–ΈνΈ IP ν™•μΈ κ°€λ¥

π“ ALBλ” κΈ°λ³Έμ μΌλ΅ ν΄λΌμ΄μ–ΈνΈ IPλ¥Ό μ§μ ‘ μ „λ‹¬ν•μ§€ μ•μ(X-Forwarded-For ν•„μ”)

---

## 4. νƒ€κ² κ·Έλ£Ή(Target Groups)

### 4.1 μ§€μ› νƒ€κ² νƒ€μ…
- **EC2 Instances**
- **IP Address**
  - On-Premises μ„λ²„ κ°€λ¥
  - Private IPλ§ ν—μ©
- **Application Load Balancer**
  - NLB β†’ ALB κµ¬μ΅° κ°€λ¥

### 4.2 ν—¬μ¤ μ²΄ν¬(Health Check)
- μ§€μ› ν”„λ΅ν† μ½:
  - **TCP**
  - **HTTP**
  - **HTTPS**
- UDP μμ²΄ ν—¬μ¤ μ²΄ν¬ β
  - UDP μ„λΉ„μ¤λΌλ„ TCP/HTTPλ΅ ν—¬μ¤ μ²΄ν¬ κµ¬μ„±

π“ μ‹ν— ν¬μΈνΈ  
> β€UDP μ„λΉ„μ¤μ μƒνƒ ν™•μΈβ€ β†’ TCP/HTTP ν—¬μ¤ μ²΄ν¬ μ‚¬μ©

---

## 5. TLS μΆ…λ£ (TLS Termination)
- NLBμ—μ„ **TLS μΆ…λ£ κ°€λ¥**
- **AWS Certificate Manager(ACM)** μΈμ¦μ„ μ‚¬μ©
- λ°±μ—”λ“λ” ν‰λ¬Έ TCPλ΅ ν†µμ‹  κ°€λ¥

π“ ALBμ™€ λ‹¬λ¦¬ L7 μ •λ³΄ ν•΄μ„ μ—†μ΄ L4μ—μ„ TLS μ²λ¦¬

---

## 6. Cross-Zone Load Balancing
- **κΈ°λ³Έμ μΌλ΅ ν™μ„±ν™”**
- AZ κ°„ νΈλν”½ λ¶„μ‚° μ‹ **μ¶”κ°€ λΉ„μ© μ—†μ**
- λ¨λ“  AZμ νƒ€κ²μ— κ· λ“± λ¶„μ‚°

---

## 7. NLB vs ALB (μ‹ν— λΉ„κµ ν¬μΈνΈ)

| ν•­λ© | NLB | ALB |
|---|---|---|
| OSI κ³„μΈµ | L4 | L7 |
| ν”„λ΅ν† μ½ | TCP/UDP/TLS | HTTP/HTTPS |
| κ³ μ • IP | O | X |
| ν΄λΌμ΄μ–ΈνΈ IP | λ³΄μ΅΄ | X-Forwarded-For |
| λΌμ°ν… | λ¶κ°€ | Path/Host/Query |
| μ§€μ—° μ‹κ°„ | λ§¤μ° λ‚®μ | λ‚®μ |

---

## 8. μ‚¬μ© μ‚¬λ΅€ (Use Case)
- λ€κ·λ¨ **TCP/UDP κΈ°λ° μ„λΉ„μ¤**
- κ²μ„ μ„λ²„, VoIP, μ‹¤μ‹κ°„ μ¤νΈλ¦¬λ°
- λ°©ν™”λ²½ IP ν™”μ΄νΈλ¦¬μ¤νΈ μ”κµ¬
- On-Prem β†” AWS ν•μ΄λΈλ¦¬λ“ ν™κ²½
- μ΄κ³ μ„±λ¥Β·μ €μ§€μ—° κΈμµ/λ„¤νΈμ›ν¬ μ‹μ¤ν…

---

## 9. SAA μ‹ν— ν•µμ‹¬ ν‚¤μ›λ“ μ •λ¦¬
- β€**Ultra low latency**β€ β†’ NLB
- β€**Static IP**β€ β†’ NLB
- β€**TCP/UDP traffic**β€ β†’ NLB
- β€**Millions of requests per second**β€ β†’ NLB
- β€**Preserve client IP**β€ β†’ NLB
- β€**Layer 4 Load Balancer**β€ β†’ NLB

---

## 10. ν• μ¤„ μ”μ•½ (μ‹ν—μ©)
> **NLBλ” Layer 4 κΈ°λ°μ μ΄κ³ μ„±λ¥ λ΅λ“ λ°Έλ°μ„λ΅, TCP/UDP νΈλν”½μ„ κ³ μ • IPμ™€ ν•¨κ» μ΄μ €μ§€μ—°μΌλ΅ μ²λ¦¬ν•  λ• μ‚¬μ©ν•λ‹¤.**

---

## 11. λΈλΌμ°μ € β†’ Load Balancer μ”μ²­ νλ¦„ λΉ„κµ

### 11.1 ALBλ΅ μ”μ²­ν•  λ• (Layer 7)

λΈλΌμ°μ €κ°€ λ³΄λ‚΄λ” μ”μ²­ μμ‹:

```http
GET /api/users?id=10 HTTP/1.1
Host: api.example.com
User-Agent: Chrome
Accept: */*
```

λ™μ‘ νλ¦„:
- **HTTP/HTTPS Listener** κ°€ μ”μ²­μ„ μμ‹ ν•κ³  **Host/Path/Header** λ¥Ό νμ‹±
- **Rule ν‰κ°€**: Host κΈ°λ°, Path κΈ°λ°, Header/Query κΈ°λ° μ΅°κ±΄μ— λ”°λΌ Target Group μ„ νƒ
- μ„ νƒλ Target Group λ‚΄ ν—¬μ‹ λ€μƒμ—κ² μ „λ‹¬, ν•„μ” μ‹ **X-Forwarded-For/Proto/Port** ν—¤λ” μ¶”κ°€
- HTTPSλΌλ©΄ **ALBμ—μ„ TLS μΆ…λ£** ν›„ L7 κ·μΉ™μ„ μ μ© (ν•„μ” μ‹ λ°±μ—”λ“λ΅ μ¬μ•”νΈν™” κ°€λ¥)

μ‹ν— ν¬μΈνΈ:
- β€κ²½λ΅/νΈμ¤νΈ κΈ°λ° λΌμ°ν…β€ β†’ ALB
- β€X-Forwarded-Forλ΅ ν΄λΌμ΄μ–ΈνΈ IP ν™•μΈβ€ β†’ ALB/CLB
- β€TLS μΆ…λ£ ν›„ L7 κ·μΉ™ μ μ©β€ β†’ ALB

### 3.2 NLBλ΅ μ”μ²­ν•  λ• (Layer 4)

λΈλΌμ°μ €κ°€ λ³΄λ‚΄λ” μ”μ²­ μμ‹(HTTPλ¥Ό TCPλ΅ μ „λ‹¬):

```http
GET /api/users?id=10 HTTP/1.1
Host: api.example.com
User-Agent: Chrome
Accept: */*
```

λ™μ‘ νλ¦„:
- **TCP/UDP/TLS Listener** κ°€ ν¨ν‚·μ„ μμ‹  (λ‚΄μ© νμ‹± μ—†μ)
- **ν¬νΈ κΈ°λ° λ§¤ν•‘** μΌλ΅ μ§€μ •λ Target Groupμ— μ „λ‹¬ (μ: TCP 80 β†’ TG-WEB)
- **Source IP λ³΄μ΅΄**: λ°±μ—”λ“κ°€ ν΄λΌμ΄μ–ΈνΈ μ‹¤μ  IPλ¥Ό μ§μ ‘ ν™•μΈ (ν”„λ΅μ‹ ν—¤λ” λ¶ν•„μ”)
- TLSμ κ²½μ° **ν†µκ³Ό(pass-through) κ°€λ¥** λλ” NLBμ—μ„ **TLS μΆ…λ£** ν›„ ν‰λ¬Έ TCPλ΅ μ „λ‹¬

μ‹ν— ν¬μΈνΈ:
- β€κ³ μ • IP, L4, μ΄μ €μ§€μ—°β€ β†’ NLB
- β€ν΄λΌμ΄μ–ΈνΈ μ‹¤μ  IP ν•„μ”β€ β†’ NLB (ALBλ” X-Forwarded-For ν•„μ”)
- β€λ‚΄μ© κΈ°λ° λΌμ°ν… λ¶κ°€, ν¬νΈ κΈ°λ° λ¶„λ°°β€ β†’ NLB

λ™μ‘ νλ¦„:
- **Listener(HTTP/HTTPS)** κ°€ μ”μ²­μ„ μμ‹ ν•κ³  ν—¤λ”/κ²½λ΅/νΈμ¤νΈλ¥Ό νμ‹±
- **Routing Rule** μ— λ”°λΌ μ ν•©ν• Target Group μ„ νƒ (μ: `/api/*` β†’ TG-API)
- Target Group λ‚΄ ν—¬μ‹ λ€μƒμ—κ² μ „λ‹¬, ν•„μ” μ‹ **X-Forwarded-For/Proto/Port** ν—¤λ” μ¶”κ°€
- λ°±μ—”λ“λ” ALBκ°€ λ§λ¶™μΈ ν—¤λ”λ¥Ό ν†µν•΄ μ›λ³Έ ν΄λΌμ΄μ–ΈνΈ IP/ν”„λ΅ν† μ½μ„ ν™•μΈ

μ‹ν— ν¬μΈνΈ:
- β€κ²½λ΅/νΈμ¤νΈ κΈ°λ° λΌμ°ν…β€ β†’ ALB
- β€X-Forwarded-Forλ΅ ν΄λΌμ΄μ–ΈνΈ IP ν™•μΈβ€ β†’ ALB/CLB

### 11.2 NLBλ΅ μ”μ²­ν•  λ• (Layer 4)

λΈλΌμ°μ €κ°€ λ³΄λ‚΄λ” μ”μ²­ μμ‹(HTTPλ¥Ό TCPλ΅ μ „λ‹¬):

```http
GET /api/users?id=10 HTTP/1.1
Host: api.example.com
User-Agent: Chrome
Accept: */*
```

λ™μ‘ νλ¦„:
- **TCP/UDP/TLS Listener** κ°€ ν¨ν‚·μ„ μμ‹  (L4, λ‚΄μ© νμ‹± μ—†μ)
- μ„¤μ •λ Target GroupμΌλ΅ **ν¬νΈ κΈ°λ°** μ „λ‹¬ (μ: TCP 80 β†’ TG-WEB)
- **Source IP λ³΄μ΅΄**: λ°±μ—”λ“κ°€ ν΄λΌμ΄μ–ΈνΈ μ‹¤μ  IPλ¥Ό μ§μ ‘ ν™•μΈ κ°€λ¥ (ν”„λ΅μ‹ ν—¤λ” μ—†μ΄)
- ν—¬μ¤ μ²΄ν¬λ” TCP/HTTP/HTTPSλ΅ μν–‰, UDPλ” λ³„λ„ μ²΄ν¬ λ¶κ°€ β†’ TCP/HTTPλ΅ κµ¬μ„±

μ‹ν— ν¬μΈνΈ:
- β€κ³ μ • IP, L4, μ΄μ €μ§€μ—°β€ β†’ NLB
- β€ν΄λΌμ΄μ–ΈνΈ μ‹¤μ  IP ν•„μ”β€ β†’ NLB (ALBλ” X-Forwarded-For ν•„μ”)

---
# Network Layer μ΄ν•΄ν•κΈ° (μ™ ALBλ” L7, NLBλ” L4μΈκ°€?)

## 1οΈβƒ£ λ¨Όμ € β€Layerβ€λ€ λ­κΉ? (OSI λ¨λΈμ ν•µμ‹¬λ§)

λ„¤νΈμ›ν¬λ” **λ‹¨κ³„λ³„λ΅ λ‚λ μ„** λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•΄μ”.  
μ‹ν—μ— ν•„μ”ν• κ±΄ λ”± **2κ° λ μ΄μ–΄**λ§ κΈ°μ–µν•λ©΄ λ©λ‹λ‹¤.

| Layer | μ΄λ¦„ | ν•λ” μΌ | μμ‹ μ§λ¬Έ |
|------|------|--------|----------|
| **Layer 4** | Transport | μ–΄λ”” μ»΄ν“¨ν„°μ **μ–΄λ ν¬νΈ**λ΅ λ³΄λ‚ΌκΉ? | TCP? UDP? |
| **Layer 7** | Application | **μ”μ²­ λ‚΄μ©μ΄ λ­μ§€?** | URL? Host? Header? |

π‘‰ **μ¤‘μ” ν¬μΈνΈ**  
- Layer μ«μκ°€ **μ»¤μ§μλ΅ λ” β€λ‚΄μ©μ„ λ§μ΄ μ•λ‹¤β€**
- Layer 7μ€ **HTTP λ‚΄μ©μ„ μ½μ„ μ μμ**
- Layer 4λ” **IP + PortκΉμ§€λ§ λ΄„**


---
# ALB vs NLB  
## λΈλΌμ°μ € μ”μ²­ κ΄€μ μ—μ„μ μ°¨μ΄ (SAA μ‹ν— λ€λΉ„)

μ•„λλ” **λΈλΌμ°μ €κ°€ μ”μ²­μ„ λ³΄λ‚Ό λ•**,  
**Application Load Balancer(ALB)** μ™€ **Network Load Balancer(NLB)** κ°€  
**μ–΄λ””κΉμ§€ μ΄ν•΄ν•κ³ , λ¬΄μ—‡μ„ κΈ°μ¤€μΌλ΅ λ™μ‘ν•λ”μ§€**λ¥Ό μ •λ¦¬ν• λ‚΄μ©μ…λ‹λ‹¤.

---

## 1. κ°€μ¥ ν•µμ‹¬ μ°¨μ΄ ν• μ¤„ μ”μ•½

- **ALB (Layer 7)**  
  π‘‰ *β€HTTP μ”μ²­ λ‚΄μ©μ„ μ΄ν•΄ν•λ‹¤β€*
- **NLB (Layer 4)**  
  π‘‰ *β€TCP μ—°κ²°λ§ μ „λ‹¬ν•λ‹¤ (λ‚΄μ©μ€ λ¨λ¥Έλ‹¤)β€*

---

## 2. OSI Layer κΈ°μ¤€ μ°¨μ΄

| κµ¬λ¶„ | ALB | NLB |
|----|----|----|
| λ™μ‘ κ³„μΈµ | **Layer 7 (Application)** | **Layer 4 (Transport)** |
| μ΄ν•΄ν•λ” μ •λ³΄ | HTTP/HTTPS μ”μ²­ λ‚΄μ© | IP, Port, TCP/UDP |
| μ”μ²­ ν•΄μ„ | κ°€λ¥ | λ¶κ°€λ¥ |
| λΈλΌμ°μ € μΉν™”μ„± | λ§¤μ° λ†’μ | κ°„μ ‘μ  |

---

## 3. λΈλΌμ°μ € β†’ Load Balancer μ”μ²­ νλ¦„ λΉ„κµ

### 3.1 ALBλ΅ μ”μ²­ν•  λ• (Layer 7)

λΈλΌμ°μ €κ°€ λ³΄λ‚΄λ” μ”μ²­ μμ‹:

```http
GET /api/users?id=10 HTTP/1.1
Host: api.example.com
User-Agent: Chrome
