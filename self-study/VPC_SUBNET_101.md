# VPC, Subnet 101
> AWS 자격증 대비를 위한 VPC (Virtual Private Cloud) 종합 학습 가이드

## 목차
1. [VPC 기본 개념](#1-vpc-기본-개념)
2. [서브넷 (Subnet)](#2-서브넷-subnet)
3. [라우팅 테이블 (Route Table)](#3-라우팅-테이블-route-table)
4. [인터넷 게이트웨이 (IGW)](#4-인터넷-게이트웨이-igw)
5. [NAT 게이트웨이 & NAT 인스턴스](#5-nat-게이트웨이--nat-인스턴스)
6. [VPC 엔드포인트](#6-vpc-엔드포인트)
7. [VPC 피링 (VPC Peering)](#7-vpc-피링-vpc-peering)
8. [VPN & Direct Connect](#8-vpn--direct-connect)
9. [네트워크 구성 실습](#9-네트워크-구성-실습)
10. [자격증 시험 팁](#10-자격증-시험-팁)

---

## 1. VPC 기본 개념

### 1.1 VPC란?
- **정의**: Virtual Private Cloud - AWS 클라우드 내 격리된 네트워크 환경
- **특징**:
  - 완전 제어 가능한 가상 네트워크
  - 리전별 생성 (각 리전마다 독립적인 VPC)
  - 기본 VPC 제공 (AWS 계정 생성 시)
  - 커스텀 VPC 생성 가능 (권장)

### 1.2 VPC의 핵심 요소
```
VPC (CIDR: 10.0.0.0/16)
├── 퍼블릭 서브넷 (10.0.1.0/24) - 인터넷 접근 가능
│   ├── 인스턴스 1 (Public IP)
│   └── 인스턴스 2 (Public IP)
│
├── 프라이빗 서브넷 (10.0.2.0/24) - 인터넷 접근 불가 (직접)
│   ├── 인스턴스 3 (프라이빗 IP만)
│   └── 인스턴스 4 (프라이빗 IP만)
│
├── 인터넷 게이트웨이 (IGW)
│   └── 퍼블릭 서브넷 ↔ 인터넷 연결
│
└── NAT 게이트웨이
    └── 프라이빗 서브넷 → 아웃바운드 인터넷 접근
```

### 1.3 CIDR 표기법
- **예시**: `10.0.0.0/16`
- **의미**: 10.0.0.0부터 10.0.255.255까지 (65,536개 주소)
- **/16**: 네트워크 마스크 (앞의 16비트가 네트워크, 뒤 16비트가 호스트)

**CIDR 블록 크기**:
| CIDR | 호스트 개수 | 사용 사례 |
|------|-----------|---------|
| /16 | 65,536 | 대규모 VPC |
| /20 | 4,096 | 중규모 VPC |
| /24 | 256 | 소규모 서브넷 |
| /28 | 16 | 매우 작은 서브넷 |

### 1.4 IP 주소 예약
VPC에서 5개의 IP는 AWS가 예약:
```
10.0.1.0     → 네트워크 주소
10.0.1.1     → VPC 라우터
10.0.1.2     → DNS 서버
10.0.1.3     → 미래 사용 예약
10.0.1.255   → 브로드캐스트 주소
```

→ 실제 사용 가능한 IP는 256개 중 251개

### 1.5 기본 VPC vs 커스텀 VPC
| 특성 | 기본 VPC | 커스텀 VPC |
|------|---------|----------|
| **생성** | 자동 | 수동 |
| **CIDR** | 172.31.0.0/16 (고정) | 사용자 정의 |
| **DNS** | 활성화 | 수동 활성화 필요 |
| **퍼블릭 IP** | 자동 할당 | 수동 설정 |
| **권장** | 테스트 용도 | 프로덕션 (권장) |

---

## 2. 서브넷 (Subnet)

### 2.1 서브넷이란?
- VPC를 더 작은 네트워크로 분할
- **AZ별 격리**: 각 서브넷은 하나의 AZ에만 속함
- 서브넷 간 통신은 라우팅 테이블로 제어

### 2.2 서브넷 유형

#### 2.2.1 퍼블릭 서브넷 (Public Subnet)
- **특징**: 인터넷 게이트웨이를 통해 인터넷 접근 가능
- **라우팅**: `0.0.0.0/0 → IGW`
- **IP 할당**: Public IP 또는 Elastic IP 필수
- **사용 사례**: 웹 서버, 로드 밸런서, NAT 게이트웨이

#### 2.2.2 프라이빗 서브넷 (Private Subnet)
- **특징**: 인터넷 직접 접근 불가
- **아웃바운드**: NAT 게이트웨이/인스턴스를 통해서만 가능
- **IP 할당**: 프라이빗 IP만
- **사용 사례**: 데이터베이스, 애플리케이션 서버, 캐시

#### 2.2.3 격리 서브넷 (Isolated Subnet)
- **특징**: NAT도 없음 (완전 격리)
- **아웃바운드**: VPC 엔드포인트로만 AWS 서비스 접근
- **사용 사례**: 데이터 처리, 배치 작업

### 2.3 서브넷 마스크와 IP 주소
```
VPC: 10.0.0.0/16 (10.0.0.0 ~ 10.0.255.255)

퍼블릭 서브넷 1: 10.0.1.0/24 (10.0.1.0 ~ 10.0.1.255)
프라이빗 서브넷 1: 10.0.2.0/24 (10.0.2.0 ~ 10.0.2.255)
퍼블릭 서브넷 2: 10.0.3.0/24 (10.0.3.0 ~ 10.0.3.255)
프라이빗 서브넷 2: 10.0.4.0/24 (10.0.4.0 ~ 10.0.4.255)
```

### 2.4 다중 AZ 구성 (권장)
```
리전 (us-east-1)
├── 가용성 영역 A (us-east-1a)
│   ├── 퍼블릭 서브넷 (10.0.1.0/24)
│   └── 프라이빗 서브넷 (10.0.2.0/24)
│
└── 가용성 영역 B (us-east-1b)
    ├── 퍼블릭 서브넷 (10.0.3.0/24)
    └── 프라이빗 서브넷 (10.0.4.0/24)
```

**이점**:
- 고가용성: 한 AZ 장애 시 다른 AZ 활용
- Load Balancer: 여러 AZ 간 로드 분산
- Auto Scaling: 자동 인스턴스 분산

> ### 🔑 퍼블릭 vs 프라이빗 서브넷 비교
> 
> | 특성 | 퍼블릭 | 프라이빗 |
> |------|---|---|
> | **인터넷 접근** | 직접 가능 (IGW) | NAT를 통해서만 가능 |
> | **인바운드** | 누구나 접근 가능 | VPC 내부만 |
> | **아웃바운드** | 직접 인터넷 | NAT 게이트웨이 필요 |
> | **Public IP** | 자동/수동 할당 | 없음 |
> | **사용 사례** | 웹 서버, LB | DB, 앱 서버 |
> | **비용** | NAT 요금 없음 | NAT 게이트웨이 요금 |

---

## 3. 라우팅 테이블 (Route Table)

### 3.1 라우팅 테이블이란?
- 서브넷의 **아웃바운드 트래픽 라우팅 규칙** 정의
- 목적지 CIDR 블록별 다음 홉 (Next Hop) 지정
- 각 서브넷은 **정확히 1개의 라우팅 테이블** 연결

### 3.2 라우팅 규칙 (Routes)
```
Destination        Target              Status
10.0.0.0/16       Local               Active
0.0.0.0/0         igw-12345678        Active
172.16.0.0/12     vpcx-abcdef12       Active
```

**주요 필드**:
- **Destination**: 목적지 CIDR 블록
- **Target**: 라우팅할 대상 (IGW, NAT, VPC Peering, VPN 등)
- **Status**: 활성/비활성
- **Propagation**: 동적 라우팅 설정 (VPN용)

### 3.3 주요 라우팅 대상
| Target | 설명 | 사용 사례 |
|--------|------|---------|
| **Local** | 같은 VPC 내 | VPC 내 모든 통신 |
| **IGW** | 인터넷 게이트웨이 | 퍼블릭 서브넷 인터넷 접근 |
| **NAT** | NAT 게이트웨이/인스턴스 | 프라이빗 서브넷 아웃바운드 |
| **VPN** | VPN 게이트웨이 | 온프레미스 네트워크 |
| **VPC Peering** | VPC 피어링 | 다른 VPC와 통신 |
| **Transit Gateway** | Transit Gateway | 여러 VPC/온프레미스 통신 |

### 3.4 라우팅 우선순위 (Longest Prefix Match)
```
예: 목적지 IP가 10.0.1.5일 때

Route 1: 10.0.0.0/16    → IGW
Route 2: 10.0.1.0/24    → Local
Route 3: 0.0.0.0/0      → NAT

선택: Route 2 (가장 긴 CIDR - /24가 /16보다 구체적)
```

### 3.5 라우팅 테이블 예시

**퍼블릭 서브넷 라우팅 테이블**:
```
Destination     Target      Purpose
10.0.0.0/16     Local       VPC 내 통신
0.0.0.0/0       igw-xxx     인터넷 트래픽
```

**프라이빗 서브넷 라우팅 테이블**:
```
Destination     Target      Purpose
10.0.0.0/16     Local       VPC 내 통신
0.0.0.0/0       nat-xxx     아웃바운드 인터넷
```

### 3.6 기본 라우팅 테이블 vs 커스텀 라우팅 테이블
- **기본**: VPC 생성 시 자동 생성 (Local만 포함)
- **커스텀**: 특정 용도로 새로 생성 (권장)

---

## 4. 인터넷 게이트웨이 (IGW)

### 4.1 인터넷 게이트웨이란?
- VPC와 인터넷 간의 **양방향 통신** 담당
- NAT 기능 수행 (프라이빗 IP ↔ 인터넷)
- **고가용성**: AWS에서 자동 관리

### 4.2 인터넷 게이트웨이 특징
- VPC당 **최대 1개만 연결** 가능
- 연결 해제 가능 (재연결 가능)
- 퍼블릭 서브넷 구성에 **필수**
- 트래픽 제한 없음 (대역폭 무제한)

### 4.3 퍼블릭 서브넷 구성 (IGW 필수)
```
1. VPC에 IGW 생성
2. VPC에 IGW 연결
3. 퍼블릭 서브넷의 라우팅 테이블에 규칙 추가:
   Destination: 0.0.0.0/0
   Target: IGW
4. 인스턴스에 Public IP 또는 EIP 할당
```

### 4.4 IGW 작동 원리
```
클라이언트 (203.0.113.25) 
    ↓
인스턴스 (10.0.1.5, Public IP: 52.1.2.3)
    ↓ [IGW가 NAT 수행: 10.0.1.5 → 52.1.2.3]
인터넷
```

### 4.5 IGW 제한 사항
- VPC 내 모든 트래픽을 처리하지는 않음
- 라우팅 테이블에 규칙이 없으면 사용 불가
- 인스턴스에 Public IP가 없으면 사용 불가

---

## 5. NAT 게이트웨이 & NAT 인스턴스

### 5.1 NAT의 필요성
**프라이빗 서브넷의 문제**:
- 인스턴스가 인터넷에 직접 접근 불가
- 패키지 업데이트, 소프트웨어 다운로드 불가
- 외부 API 호출 불가

**해결책**: NAT 게이트웨이 또는 NAT 인스턴스 사용

### 5.2 NAT 게이트웨이 (권장)
- AWS 관리형 서비스 (고가용성)
- Elastic IP 필수 (고정 아웃바운드 IP)
- **퍼블릭 서브넷에 배치** (필수)
- 높은 성능 (5Gbps, 확장 가능)
- 프라이빗 서브넷 → NAT 게이트웨이 → 인터넷

#### 5.2.1 NAT 게이트웨이 설정 단계
```
1. Elastic IP 할당
2. 퍼블릭 서브넷에 NAT 게이트웨이 생성
3. 프라이빗 서브넷의 라우팅 테이블에 규칙 추가:
   Destination: 0.0.0.0/0
   Target: NAT 게이트웨이
```

#### 5.2.2 NAT 게이트웨이 특징
- **상태**: Creating → Available → Deleting
- **상태 체크**: CloudWatch 모니터링
- **비용**: 시간당 비용 + 데이터 처리량 비용
- **대역폭**: 5Gbps (필요 시 증설)

### 5.3 NAT 인스턴스 (구식)
- EC2 인스턴스에서 NAT 소프트웨어 실행
- **단점**: 
  - 수동 관리 필요
  - 단일 인스턴스 (SPOF)
  - 성능 제한 (인스턴스 유형에 따라)
- **장점**:
  - 비용 절감 (t3.nano 사용)
  - 보안 그룹 세밀 제어
- **권장**: NAT 게이트웨이 사용

### 5.4 NAT 게이트웨이 vs NAT 인스턴스

| 특성 | NAT 게이트웨이 | NAT 인스턴스 |
|------|---|---|
| **관리** | AWS 관리 | 사용자 관리 |
| **가용성** | 고가용성 | SPOF |
| **성능** | 5Gbps | 인스턴스에 따라 |
| **비용** | 높음 | 낮음 |
| **보안 그룹** | 불가 | 가능 (세밀 제어) |
| **스케일링** | 자동 | 수동 |
| **권장** | 프로덕션 | 테스트, 비용 절감 |

### 5.5 다중 AZ NAT 게이트웨이 (고가용성)
```
리전 (us-east-1)
├── AZ A
│   ├── 퍼블릭 서브넷
│   │   └── NAT 게이트웨이 1
│   └── 프라이빗 서브넷
│       └── 라우팅: 0.0.0.0/0 → NAT-1
│
└── AZ B
    ├── 퍼블릭 서브넷
    │   └── NAT 게이트웨이 2
    └── 프라이빗 서브넷
        └── 라우팅: 0.0.0.0/0 → NAT-2
```

**이점**:
- 한 NAT 장애 시 다른 NAT 사용
- AZ 간 통신 최소화
- 비용 증가 (NAT 게이트웨이 2개)

---

## 6. VPC 엔드포인트

### 6.1 VPC 엔드포인트란?
- VPC 내에서 **AWS 서비스에 비공개 접근** 제공
- 인터넷 게이트웨이, NAT 게이트웨이 불필요
- 아웃바운드 데이터 비용 절감

### 6.2 VPC 엔드포인트 유형

#### 6.2.1 Gateway 엔드포인트
- **지원 서비스**: S3, DynamoDB
- **구성**: 라우팅 테이블에 규칙 추가
- **비용**: 무료
- **사용 예**:
  ```
  프라이빗 서브넷 인스턴스 → S3 (인터넷 경유 안 함)
  ```

#### 6.2.2 Interface 엔드포인트
- **지원 서비스**: 대부분의 AWS 서비스 (90+)
- **구성**: Elastic Network Interface (ENI) 생성
- **비용**: 시간당 비용 + 데이터 처리량
- **사용 예**:
  ```
  프라이빗 서브넷 → EC2, Lambda, SQS, SNS, CloudWatch 등
  ```

### 6.3 Gateway vs Interface 엔드포인트

| 특성 | Gateway | Interface |
|------|---------|-----------|
| **지원 서비스** | S3, DynamoDB | 90+ 서비스 |
| **구현** | 라우팅 테이블 | ENI + DNS |
| **비용** | 무료 | 유료 |
| **DNS** | 필요 없음 | 필요 |
| **보안 그룹** | 불가 | 가능 |

### 6.4 VPC 엔드포인트 정책
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::my-bucket/*"
    }
  ]
}
```

---

## 7. VPC 피링 (VPC Peering)

### 7.1 VPC 피링이란?
- **두 VPC 간 비공개 연결**
- AWS 내부 네트워크 사용 (인터넷 경유 안 함)
- **별개의 VPC**: 다른 계정/리전도 가능

### 7.2 VPC 피링 특징
- **일대일 관계**: A ↔ B
- **전이적 피링 불가**: A ↔ B, B ↔ C여도 A ↔ C 불가
- **CIDR 충돌 불가**: 피어링 VPC의 CIDR이 겹치면 안 됨
- **비용**: 리전 간 데이터 전송 비용만

### 7.3 VPC 피링 설정 단계
```
1. 피어링 연결 생성 요청 (Requester VPC)
2. 피어링 연결 수락 (Accepter VPC)
3. 양쪽 VPC의 라우팅 테이블 업데이트:
   Destination: 상대 VPC CIDR
   Target: 피어링 연결 ID
4. 보안 그룹 규칙 추가
```

### 7.4 VPC 피링 사용 사례
- 별도 팀의 VPC 간 통신
- 프로덕션/개발 환경 분리
- 다른 AWS 계정 간 통신
- 멀티 리전 배포

### 7.5 VPC 피링 대안: Transit Gateway
```
문제: A ↔ B, B ↔ C, C ↔ D → 6개 피어링 필요
해결: Transit Gateway 사용 → 1개 경로로 모두 연결
```

---

## 8. VPN & Direct Connect

### 8.1 VPN (Virtual Private Network)
- **온프레미스 네트워크 ↔ VPC 연결**
- 인터넷 경유 (공개 IP 사용)
- **암호화 필수**

#### 8.1.1 Site-to-Site VPN
- 회사 네트워크 ↔ AWS VPC
- CGW (Customer Gateway) + VGW (Virtual Gateway)
- 설정 단계:
  ```
  1. VPC에 Virtual Gateway 생성
  2. VPC에 Virtual Gateway 연결
  3. Customer Gateway 생성 (온프레미스 장비 정보)
  4. VPN 연결 생성
  5. 라우팅 테이블 업데이트 (온프레미스 CIDR)
  ```

#### 8.1.2 Client VPN
- 개인 사용자 ↔ VPC
- VPN 클라이언트 소프트웨어 필요

### 8.2 AWS Direct Connect
- **전용 네트워크 연결** (인터넷 경유 안 함)
- 물리적 연결 (최소 1Gbps)
- **고성능, 낮은 지연시간**
- **높은 비용**

### 8.3 VPN vs Direct Connect

| 특성 | VPN | Direct Connect |
|------|-----|---|
| **경로** | 인터넷 | 전용 연결 |
| **성능** | 보통 | 높음 |
| **지연시간** | 높음 | 낮음 |
| **설정** | 빠름 | 느림 (물리 설치) |
| **비용** | 낮음 | 높음 |
| **보안** | 암호화 필수 | 물리적 보안 |
| **사용 사례** | 임시 연결 | 장기 고성능 필요 |

---

## 9. 네트워크 구성 실습

### 9.1 기본 VPC 아키텍처 구성 (권장)

```
리전: us-east-1
VPC: 10.0.0.0/16

AZ A (us-east-1a):
├── Public Subnet: 10.0.1.0/24
│   ├── NAT Gateway (EIP)
│   └── Web Server Instance
│
└── Private Subnet: 10.0.2.0/24
    └── Database Instance

AZ B (us-east-1b):
├── Public Subnet: 10.0.3.0/24
│   └── Web Server Instance
│
└── Private Subnet: 10.0.4.0/24
    └── Database Instance

Internet Gateway ← 퍼블릭 서브넷 연결
```

### 9.2 단계별 VPC 구성

#### 단계 1: VPC 생성
```
AWS 콘솔 > VPC > VPC 생성
- VPC 이름: MyVPC
- CIDR: 10.0.0.0/16
- 테넌시: 기본
- DNS 호스트명: 활성화 (권장)
- DNS 확인: 활성화 (권장)
```

**검증**:
- VPC 생성 확인
- 기본 라우팅 테이블 확인 (Local만 포함)
- 기본 NACL 확인

#### 단계 2: 인터넷 게이트웨이 생성 및 연결
```
AWS 콘솔 > VPC > 인터넷 게이트웨이 > 생성
- 이름: MyIGW
- 생성 후 VPC에 연결

VPC > 인터넷 게이트웨이 > MyIGW > VPC 연결
- VPC: MyVPC 선택
```

**검증**:
- IGW 상태: attached

#### 단계 3: 공개 서브넷 생성 (AZ A)
```
AWS 콘솔 > VPC > 서브넷 > 서브넷 생성
- VPC: MyVPC
- 서브넷 이름: Public-Subnet-AZ-A
- 가용성 영역: us-east-1a
- IPv4 CIDR: 10.0.1.0/24

생성 후 설정:
- 서브넷 > Public-Subnet-AZ-A > 작업 > 퍼블릭 IP 자동 할당 활성화
```

#### 단계 4: 공개 서브넷 라우팅 테이블 생성
```
AWS 콘솔 > VPC > 라우팅 테이블 > 라우팅 테이블 생성
- 이름: Public-RT
- VPC: MyVPC

규칙 추가:
- Destination: 0.0.0.0/0
- Target: IGW (MyIGW)

서브넷 연결:
- 라우팅 테이블 > Public-RT > 서브넷 연결 > Public-Subnet-AZ-A
```

#### 단계 5: 비공개 서브넷 생성 (AZ A)
```
AWS 콘솔 > VPC > 서브넷 > 서브넷 생성
- VPC: MyVPC
- 서브넷 이름: Private-Subnet-AZ-A
- 가용성 영역: us-east-1a
- IPv4 CIDR: 10.0.2.0/24
```

#### 단계 6: Elastic IP 할당
```
AWS 콘솔 > EC2 > 탄력적 IP > 탄력적 IP 할당
- 도메인: VPC
- 할당

생성된 Elastic IP 메모: (예: 203.0.113.25)
```

#### 단계 7: NAT 게이트웨이 생성
```
AWS 콘솔 > VPC > NAT 게이트웨이 > NAT 게이트웨이 생성
- 이름: MyNAT
- 서브넷: Public-Subnet-AZ-A (중요!)
- Elastic IP: 위에서 할당받은 EIP

상태 확인: available 될 때까지 대기 (1-5분)
```

#### 단계 8: 비공개 서브넷 라우팅 테이블 생성
```
AWS 콘솔 > VPC > 라우팅 테이블 > 라우팅 테이블 생성
- 이름: Private-RT
- VPC: MyVPC

규칙 추가:
- Destination: 0.0.0.0/0
- Target: NAT 게이트웨이 (MyNAT)

서브넷 연결:
- 라우팅 테이블 > Private-RT > 서브넷 연결 > Private-Subnet-AZ-A
```

#### 단계 9: 고가용성을 위한 AZ B 구성 반복
```
위의 단계 3~8을 AZ B(us-east-1b)에서 반복:
- Public-Subnet-AZ-B: 10.0.3.0/24
- Private-Subnet-AZ-B: 10.0.4.0/24
- 별도의 NAT 게이트웨이 (권장) 또는 공유 (비용 절감)

주의: NAT 게이트웨이는 특정 AZ에만 서비스하므로,
     완전한 고가용성을 위해 각 AZ에 NAT 게이트웨이 필요
```

#### 단계 10: 보안 그룹 생성
```
AWS 콘솔 > EC2 > 보안 그룹 > 보안 그룹 생성

웹 서버 보안 그룹 (Web-SG):
- VPC: MyVPC
- Inbound:
  - HTTP (80): 0.0.0.0/0
  - HTTPS (443): 0.0.0.0/0
  - SSH (22): Your-IP/32
- Outbound: 모든 트래픽 (기본값)

데이터베이스 보안 그룹 (DB-SG):
- VPC: MyVPC
- Inbound:
  - MySQL (3306): Web-SG (보안 그룹 참조)
- Outbound: 모든 트래픽 (기본값)
```

#### 단계 11: EC2 인스턴스 생성 및 배포

**퍼블릭 서브넷 (웹 서버)**:
```
AWS 콘솔 > EC2 > 인스턴스 > 인스턴스 시작

1. AMI 선택: Amazon Linux 2
2. 인스턴스 유형: t3.micro
3. 네트워크 설정:
   - VPC: MyVPC
   - 서브넷: Public-Subnet-AZ-A
   - 퍼블릭 IP 자동 할당: 활성화
   - 보안 그룹: Web-SG
4. 스토리지: 기본 (8GB)
5. 사용자 데이터:
   #!/bin/bash
   yum update -y
   yum install -y httpd
   systemctl start httpd
   systemctl enable httpd
   echo "<h1>Web Server in Public Subnet</h1>" > /var/www/html/index.html
```

**프라이빗 서브넷 (데이터베이스)**:
```
AWS 콘솔 > RDS 또는 EC2 > 인스턴스 생성

1. AMI: Amazon Linux 2
2. 인스턴스 유형: t3.micro
3. 네트워크:
   - VPC: MyVPC
   - 서브넷: Private-Subnet-AZ-A
   - 퍼블릭 IP: 비활성화
   - 보안 그룹: DB-SG
4. 사용자 데이터:
   #!/bin/bash
   yum update -y
   yum install -y mariadb-server
   systemctl start mariadb
   systemctl enable mariadb
```

#### 단계 12: 연결성 테스트

**테스트 1: 퍼블릭 인스턴스 접근**
```bash
# 터미널에서
ssh -i MyKeyPair.pem ec2-user@<public-ip>

# 인스턴스 내에서
curl http://169.254.169.254/latest/meta-data/public-ipv4
```

**테스트 2: 퍼블릭 → 프라이빗 통신**
```bash
# 웹 서버(퍼블릭)에서 프라이빗 인스턴스로 접근
ssh 10.0.2.5  # 프라이빗 IP

또는

ping 10.0.2.5
```

**테스트 3: 프라이빗 → 인터넷 (NAT)**
```bash
# 프라이빗 인스턴스에서
curl http://example.com
curl http://169.254.169.254/latest/meta-data/public-ipv4  # NAT의 EIP 반환
```

**테스트 4: 라우팅 테이블 확인**
```bash
# 웹 서버에서 라우팅 확인
ip route show
또는
route -n
```

**테스트 5: 보안 그룹 확인**
```bash
# 웹 서버 포트 80 확인
curl localhost:80

# 프라이빗 인스턴스 MySQL 포트 확인
mysql -h 10.0.2.5 -u root
```

### 9.3 실습 체크리스트
- [ ] VPC 생성 (CIDR: 10.0.0.0/16)
- [ ] IGW 생성 및 VPC 연결
- [ ] 2개 AZ에 퍼블릭 서브넷 생성 (10.0.1.0/24, 10.0.3.0/24)
- [ ] 2개 AZ에 프라이빗 서브넷 생성 (10.0.2.0/24, 10.0.4.0/24)
- [ ] 퍼블릭 라우팅 테이블 생성 및 IGW 라우팅 규칙 추가
- [ ] 각 AZ에 NAT 게이트웨이 생성
- [ ] 프라이빗 라우팅 테이블 생성 및 NAT 라우팅 규칙 추가
- [ ] 웹 서버 보안 그룹 생성 (80, 443, 22)
- [ ] 데이터베이스 보안 그룹 생성 (3306, 5432 등)
- [ ] 퍼블릭 서브넷에 웹 서버 인스턴스 배포
- [ ] 프라이빗 서브넷에 데이터베이스 인스턴스 배포
- [ ] SSH로 웹 서버 접근 확인
- [ ] 웹 서버에서 프라이빗 인스턴스로 통신 확인
- [ ] 프라이빗 인스턴스에서 인터넷 아웃바운드 확인 (NAT 경유)

---

## 10. 자격증 시험 팁

### 10.1 자주 출제되는 개념
1. **VPC 설계**
   - 퍼블릭/프라이빗 서브넷 구분
   - 다중 AZ 고가용성
   - CIDR 블록 계획

2. **라우팅 및 네트워크**
   - 라우팅 테이블 규칙 해석
   - 트래픽 흐름 추적
   - 최장 접두사 일치 (LPM)

3. **보안**
   - Security Group vs NACL
   - Stateful vs Stateless
   - 인바운드/아웃바운드 규칙

4. **시나리오 문제**
   - 프라이빗 인스턴스의 인터넷 접근 → NAT 게이트웨이
   - 온프레미스 연결 → VPN/Direct Connect
   - 최소 비용으로 고가용성 → 다중 AZ + 로드 밸런싱

### 10.2 실수하기 쉬운 부분
- ❌ NAT 게이트웨이를 프라이빗 서브넷에 배치 → ✅ 퍼블릭 서브넷에 배치
- ❌ VPC당 여러 IGW 연결 → ✅ VPC당 최대 1개만 가능
- ❌ 기본 라우팅 테이블 수정 → ✅ 커스텀 라우팅 테이블 사용
- ❌ 보안 그룹에 DENY 규칙 추가 → ✅ ALLOW만 가능
- ❌ 프라이빗 서브넷에서 EIP 사용 → ✅ 퍼블릭 서브넷에서만 의미있음

### 10.3 실전 팁
- **그림 그리기**: 네트워크 아키텍처를 그려가며 이해
- **라우팅 추적**: 특정 트래픽이 어느 경로로 이동하는지 추적
- **비용 고려**: NAT 게이트웨이, 데이터 전송 요금 고려
- **보안 우선**: 최소 권한 원칙 (Least Privilege)
- **문서 참고**: AWS 공식 문서 숙지

### 10.4 추가 학습 자료
- [AWS VPC 사용자 가이드](https://docs.aws.amazon.com/vpc/)
- [AWS 네트워킹 백서](https://aws.amazon.com/whitepaper/)
- [AWS Well-Architected Framework - 보안 기둥](https://aws.amazon.com/architecture/well-architected/)

---

## 요약 표: VPC 구성 요소 비교

| 요소 | 목적 | 배치 | 비용 |
|------|------|------|------|
| **VPC** | 격리된 네트워크 | 리전 | 무료 |
| **Subnet** | 네트워크 분할 | VPC 내 | 무료 |
| **IGW** | 인터넷 연결 | VPC | 무료 |
| **NAT Gateway** | 아웃바운드 NAT | 퍼블릭 서브넷 | 유료 |
| **라우팅 테이블** | 트래픽 라우팅 | 서브넷 | 무료 |
| **보안 그룹** | 인스턴스 방화벽 | 인스턴스 | 무료 |
| **NACL** | 서브넷 방화벽 | 서브넷 | 무료 |
| **VPC 엔드포인트** | AWS 서비스 비공개 접근 | VPC | Gateway: 무료, Interface: 유료 |
| **VPC Peering** | VPC 간 연결 | VPC 쌍 | 리전 간 데이터 전송만 |
| **VPN** | 온프레미스 연결 | VGW | 유료 |